# --- Etapa 1: "Build" (Compilación) ---
# Usamos una imagen de Node.js (Alpine es una versión ligera)
FROM node:18-alpine AS builder

# Establecemos el directorio de trabajo dentro del contenedor
WORKDIR /app

# Copiamos el package.json y package-lock.json primero
# Esto aprovecha la caché de Docker y no reinstala todo si no cambian
COPY package*.json ./

# Instalamos las dependencias
RUN npm install

# Copiamos el resto del código de tu proyecto
COPY . .

# Ejecutamos el script de "build" (usualmente 'npm run build')
# Esto creará la carpeta /app/dist
RUN npm run build

# --- Etapa 2: "Serve" (Producción) ---
# Empezamos desde una imagen de Nginx limpia y ligera
FROM nginx:1.25-alpine

# Copiamos SOLO los archivos compilados de la etapa "builder"
# desde la carpeta /app/dist hacia la carpeta web de Nginx
COPY --from=builder /app/dist /usr/share/nginx/html

# (Opcional) Si usas Vue Router en modo "history", necesitas un nginx.conf
# Descomenta la siguiente línea si tienes un archivo nginx.conf personalizado
# COPY nginx.conf /etc/nginx/conf.d/default.conf

# Exponemos el puerto 80, que es el que Nginx usa por defecto
EXPOSE 80

# El comando para iniciar Nginx (ya viene en la imagen, pero es bueno tenerlo)
CMD ["nginx", "-g", "daemon off;"]